发布与订阅消息系统：
    数据的发送者不会直接把消息发送给接收者，而是对消息进行分类，然后接受者订阅特定类型的消息，这是发布与订阅消息系
统的特点。发布与订阅系统一般会有一个broker，也是发布消息的中间点，broker主要用来分发消息，也可以提供一些额外的功
能，比如延迟发送

kafka的消息简介：
    kafka的消息有一个可选的元数据，也就是键。键与消息一样也是一个字节数组，当需要消息以一种可控的方式写入不同分区时
，就会用到键，最简单的就是用键生成HashCode，然后对分区数进行取模，为消息分区，这样保证了相同键的消息总是被写到相
同的分区上

kafka的批次简介：
    为了提高效率，消息被分批次写入kafka，批次就是一组消息，这些消息属于同一个主题和同一个分区，如果每个消息都单独穿
行于网络，会导致大量网络开销。
    把消息分成批次传输可以减少网络开销，不过会造成延迟，所以需要在延迟与吞吐量之间做出权衡。批次越大，单位时间内处
理的消息就越多，单个消息的传输时间就越长。批次数据会被压缩，这样可以提升数据传输与存储能力，但要做更多计算处理


消息模式简介：
    消息不过是晦涩难懂的字节数组，消息模式可以以特定的结构来定义消息内容，比如JSON和XML。其实模式指的就是序列号方
式。模式与消息是分开的，当模式发生变化时，不需要重新生成代码

主题和分区简介：
    kafka的消息通过主题进行分类。主题就好比数据库的表，或文件系统的文件夹。主题可以被氛围若干个分区，一个分区就是一
个提交日志。消息以追加的方式写入分区，然后以先入先出的顺序读取
    由于一个主题包含多个分区，因此无法在整个主题范围内保证消息的顺序，但可以保证消息在单个分区内的顺序
    kafka通过分区来实现数据冗余和伸缩性。分区可以分布在不同的服务器上，也就是说一个主题可以横跨多个服务器，以此来提
供比单个服务器更强大的性能
    我们通常会用流这个词来描述kafka这类系统的数据

生产者和消费者简介：
    生产者创建消息，一般情况下，一个消息会被发布到一个特定的主题上。
    生产者在默认情况下会把消息均衡地分布到主题的所有分区上，而不关心消息会被写到哪个分区。不过如果指定了分区键和分
区器，生产会把消息写到指定的分区，分区器会为键生成一个散列值，并将其映射到指定的分区上。这样保证了同一个键会被写到
同一个分区上。生产者也可以使用自定义的分区器，根据不同的业务规则将消息映射到分区
    消费者读取消息。消费者订阅一个或多个主题，并按照消息生成的顺序读取它们。
    消费者通过检查消息的偏移量来区分已经读取过的消息，偏移量是一个不断递增的整数值，在一个分区里，每个消息的偏移量
都是唯一的。消费者把每个分区最后读取的消息偏移量保存在zookeeper或kafka上，保证消费者关闭或重启后，读取状态不丢失
    消费者是消费者组的一部分，也就是说，会有一个或多个消费者共同读取一个主题。群组保证每个分区只能被一个消费者使用，
但是一个消费者可以同时消费多个分区，因为这样才能保证消息消费的顺序
    如果一个消费者失效，群组里的其它消费者可以接管失效消费者的工作，也就是去接手消费它的分区

broker和集群简介：
    一个独立的kafka服务器被称为broker。broker接受来自生产者的消息，为消息设置偏移量，并将消息保存到磁盘。broker为
消费者提供服务，对读取分区的请求做出响应，返回磁盘上已提交的消息。根据特定的硬件与性能特征，单个broker可以轻松处理
数千个分区以及每秒百万级的消息量
    broker是集群的组成部分。每个集群都有一个broker同时充当了集群控制器的角色，这个角色是自动选举出来的。控制器负责
管理工作，包括将分区分配给broker和监控broker。
    在集群中，一个分区属于一个broker，该broker称为该分区的首领。一个分区可以分配给多个broker，此时会发生分区复制，
这种复制机制为分区提供了消息冗余，如果某个分区的首领broker失效了，其它broker可以接管该分区的领导权，不过生产者和
消费者都要连接到新的首领broker

保留消息：
    kafka broker的消息保留策略是：要么保留一段时间(比如7天)，要么在保留消息的字节数达到一定大小(比如1G)。当消息达到
上限时，旧消息就会过期并被删除
    每个主题都可以配置自己的保留策略。也可以通过配置将主题当做紧凑型日志，紧凑型日志只会为每个不同的键保留最后一条
变更的消息

多集群：
    随着kafka部署数量的增加，基于以下原因，最好使用多个集群：
        1、数据类型分离
        2、安全需求隔离
        3、多数据中心(灾难恢复)
    多个数据中心之间，如果要保证数据一致，就需要在它们之间复制消息。不过kafka的消息复制机制只能在单个集群里进行，不
能在多个集群之间进行
    不过kafka提供了一个叫做MirrorMaker的工具，它可以实现集群间的消息复制。MirrorMaker的核心组件包含了一个生产者和
一个消费者，两者通过一个队列连接。消费者从一个集群中读取消息，生产者再把消息发送到另一个集群上。
    比如，多个Kafka集群都先用MirrorMaker的消费者消费消息，然后用生产者发送到另一个统一聚合集群里，然后将这个聚合集
群的消息再用相同的方式复制到另一个数据中心即可



























































